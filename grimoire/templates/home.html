{% import 'updates-macro.html' as updates %}
{% import 'macros.html' as macros %}
{% extends "layout.html" %}
{% block body %}

<div id="content">
    <blockquote>
        <strong>Grimoire</strong> <em>n.</em>
        a book of magic spells and invocations. From the mid 19th century: French, alteration of grammaire (grammar).
        <br>
        <em><a href="https://www.oxforddictionaries.com/us/definition/american_english/grimoire">Oxford English
            Dictionary</a></em>
    </blockquote>

    <p>
        This site is a collection of linked pieces of information about grimoires, focusing (with some distraction), on
        early modern Western European texts from the Christian tradition.
        The goal is to look at the connections and relationships within the metadata and subject matter of these grimoires,
        and attempt to collect factual information about their provenance and historical context.
    </p>

    <div class="divider"></div>

    <h2>Events in grimoire history</h2>
    <section class="map-slider row">
        <div class="small-10 columns">
            <div class="row">
                <label class="columns medium-4">3rd Century</label>
                <label class="columns medium-4"><strong id="current-dates"></strong></label>
                <label class="columns medium-4">1850</label>
            </div>
            <input type="range" id="date-slider" min="200" max="1850" onchange="setDate()" step="10">
        </div>
        <div class="small-2 columns">
              <input type="number" id="date-input" min="200" max="1850" step="1" onchange="setDateSlider()">
        </div>
    </section>
    <section class="map-container">
        <div id="map"></div>
    </section>
    <div class="divider-minor"></div>
    <section id="item-lists">
        <ul class="card accordion" data-accordion data-allow-all-closed="true">
            <li class="accordion-item" data-accordion-item>
                <a class="accordion-title"><h3>Events shown here <span id="map-count"></span></h3></a>
                <div id="map-links" class="accordion-content" data-tab-content></div>
            </li>
        </ul>
    </section>

    <div class="divider"></div>

    <div class="row infopanel">
        <div class="column medium-4">
            <h3>Site Updates</h3>
            {{ updates.update_content() }}
            <a href="/updates">Full history</a>
        </div>
        <div class="column medium-4">
            <h3>Random Spell</h3>
            <p>
                <a href="{{excerpt.link}}"><strong>{{ excerpt.props.identifier }}</strong></a>
                <blockquote>
                    <p>{{ excerpt.props.content | safe }}</p>
                </blockquote>
            </p>
                From {% if excerpt.props.source_url and not excerpt.props.editor %}<a href="{{ excerpt.props.source_url }}" target="_blank">{% endif %}
                <em>{{ excerpt.props.source_title }}</em>{% if excerpt.props.source_url and not excerpt.props.editor %}</a>{% endif %}{% if excerpt.props.editor %}, {% if excerpt.props.source_url %}<a href="{{ excerpt.props.source_url }}" target="_blank">{% endif %}{{ excerpt.props.editor }}{% if excerpt.props.source_url %}</a>{% endif %} edition{% endif %}{% if excerpt.props.source_year %} ({{ excerpt.props.source_year }}){% endif %}:
            <a href="/spell">More spells</a>
        </div>
        <div class="column medium-4">
            <h3>Resources</h3>
            <p>If you can't find what you are looking for here, leave <span class="link" data-open="feedback">feedback</span>, or try some of these sites:</p>
            <p>
                <a href="http://esotericarchives.com/" target="_blank">Twilit Grotto</a>:
                the best resource for full texts of grimoires, with excellent scholarship.
            </p>
            <p>
                <a href="https://danharms.wordpress.com/" target="_blank">Dan Harms' blog</a>:
                well-researched articles on magical topics, and critical reviews of grimoire publications.</a>
            </p>
            <p>
                <a href="http://www.sacred-texts.com/" target="_blank">Sacred Texts</a>,
                <a href="http://www.hermetics.org/home.html" target="_blank">Hermetics.org</a>,
                and the <a href="https://archive.org/details/fav-tripofmice" target="_blank">Internet Archive</a>
                host a number of texts in the public domain.
            </p>
        </div>
    </div>

    <div class="divider"></div>

    <h2>Grimoires</h2>
    {% if grimoires %}
    <ul>
        {% for grimoire in grimoires %}
        <li><a href="/grimoire/{{ grimoire.uid }}">{{ grimoire.identifier }}</a> ({{ grimoire.date }})</li>
        {% endfor %}
    </ul>
    {% else %}
    <p>Sorry, we're unable to access the database at this time.</p>
    {% endif %}
</div>

<div id="feedback" class="reveal" data-reveal>
    <h2>Feedback</h2>
    <form action="/feedback" method="post">
        <label for="comments">Comments</label>
        <textarea name="comments" id="comments" required></textarea>
        <label for="email">Email (optional - include if you would like a response)</label>
        <input type="text" id="email" name="email">
        <input type="submit" value="Submit">

        <button class="close-button" data-close aria-label="Close reveal" type="button">
            <span aria-hidden="true">&times;</span>
        </button>
    </form>
</div>

<script>
    var events = [
    {% for event in events %}
        {
            identifier: "{{ event.props.identifier }}",
            link: "{{ event.link }}",
            year: {{ event.props.date }},
            {% if event.props.end_date %}end_year: {{ event.props.end_date }},{% endif %}
            place: "{{ event.props.location }}",
            radius: 10,
            fillOpacity: {% if event.props.location_precision == 'continent' %}0.40{% else %}0.75{% endif %},
            latitude: {{ event.props.latitude }},
            longitude: {{ event.props.longitude }},
            fillKey: "{{ event.props.event }}",
            display_date: "{% if event.props.end_date %}{{ event.props.date }} - {{event.props.end_date }} {% else %}{{ event.props.display_date }}{% endif %}"
        },
    {% endfor %}
    ];
</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
<script src="/static/js/vendor/datamaps.world.min.js"></script>
{% endblock %}
